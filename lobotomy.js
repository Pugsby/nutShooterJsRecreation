var catPosition,bombPosition,gameCanvas=document.getElementById("gameCanvas"),ctx=gameCanvas.getContext("2d"),animationFrame=Math.floor(1e3*Math.random()),bombAnimationFrame=Math.floor(1e3*Math.random()),exploded=!1,won=!1,bgImage=new Image,macamoImage=new Image,catImage=new Image,bombImage=new Image,wallImage=new Image,cannonImage=new Image,leftArrow=new Image,rightArrow=new Image,nut=new Image,floor=new Image,catAnimation="idle",bombAnimation="idle",macamoAnimation="idle",leftArrowAnimation="idle",rightArrowAnimation="idle",nutAnimation="hit0",wallEnabled=!1,shot=!1,nutX=1600*Math.random(),nutY=1200*Math.random(),shootDirection=Math.random()<.5?-1:1,nutSpeedX=(40*Math.random()+10)*(Math.random()<.5?-1:1),nutSpeedY=20*Math.random()+5,hitSfx=new Audio("assets/sounds/hit.wav"),boomSfx=new Audio("assets/sounds/explode.wav"),meowSfx=new Audio("assets/sounds/meow.wav"),cannonSfx=new Audio("assets/sounds/cannon.wav"),song=new Audio("assets/sounds/song.wav"),textureSet="default",textureSets={default:[],noDither:["cat","macamo"]};function init(){catPosition=Math.round(Math.random()),bombPosition=1-catPosition,wallEnabled=Math.random()>.5}function getImagePath(a,t,n,e){return e||(e=animationFrame),textureSets[textureSet]&&Array.isArray(textureSets[textureSet])&&textureSets[textureSet].includes(a)?"assets/"+textureSet+"/"+a+"/"+t+"/"+(e%n).toString()+".png":"assets/images/"+a+"/"+t+"/"+(e%n).toString()+".png"}function randomSize(a){return a*(2*Math.random()+.5)}function drawBackground(){bgImage.src=getImagePath("world","bg",1),bgImage.onload=function(){ctx.drawImage(bgImage,100*Math.random()-50,100*Math.random()-50,randomSize(10*bgImage.width),randomSize(10*bgImage.height))}}function drawMacamo(){macamoImage.src=getImagePath("macamo",macamoAnimation,2),macamoImage.onload=function(){ctx.drawImage(macamoImage,1600*Math.random(),1200*Math.random(),randomSize(10*macamoImage.width),randomSize(10*macamoImage.height))}}function drawCat(){catImage.src=getImagePath("cat",catAnimation,2),catImage.onload=function(){ctx.drawImage(catImage,1600*Math.random(),1200*Math.random(),randomSize(10*catImage.width),randomSize(10*catImage.height))}}function drawBomb(){bombImage.src=getImagePath("bomb",bombAnimation,exploded?3:2,bombAnimationFrame),bombImage.onload=function(){ctx.drawImage(bombImage,1600*Math.random(),1200*Math.random(),randomSize(10*bombImage.width),randomSize(10*bombImage.height))}}function drawWall(){wallEnabled&&(wallImage.src=getImagePath("world","wall",1),wallImage.onload=function(){ctx.drawImage(wallImage,1600*Math.random(),1200*Math.random(),randomSize(10*wallImage.width),randomSize(10*wallImage.height))})}function drawCannon(){cannonImage.src=getImagePath("cannon",macamoAnimation,2),cannonImage.onload=function(){ctx.drawImage(cannonImage,1600*Math.random(),1200*Math.random(),randomSize(10*cannonImage.width),randomSize(10*cannonImage.height))}}function drawArrows(){leftArrow.src=getImagePath("arrow/left",leftArrowAnimation,2),leftArrow.onload=function(){ctx.drawImage(leftArrow,1600*Math.random(),1200*Math.random(),randomSize(10*leftArrow.width),randomSize(10*leftArrow.height))},rightArrow.src=getImagePath("arrow/right",rightArrowAnimation,2),rightArrow.onload=function(){ctx.drawImage(rightArrow,1600*Math.random(),1200*Math.random(),randomSize(10*rightArrow.width),randomSize(10*rightArrow.height))}}function drawNut(){nut.src=getImagePath("nut",nutAnimation,2),nut.onload=function(){ctx.drawImage(nut,nutX,nutY,randomSize(10*nut.width),randomSize(10*nut.height))}}function drawFloor(){floor.src=getImagePath("world","floor",1),floor.onload=function(){ctx.drawImage(floor,1600*Math.random(),1200*Math.random(),randomSize(10*floor.width),randomSize(10*floor.height))}}function gameLoop(){drawBackground(),drawNut(),drawFloor(),Promise.all([new Promise((a=>{drawMacamo(),setTimeout(a,0)})),new Promise((a=>{drawCat(),setTimeout(a,0)})),new Promise((a=>{bombAnimationFrame!=animationFrame&&bombAnimationFrame>2||drawBomb(),setTimeout(a,0)}))]),drawWall(),drawCannon(),drawArrows(),requestAnimationFrame(gameLoop),started||(ctx.save(),ctx.globalAlpha=Math.random(),ctx.fillStyle="#"+Math.floor(16777215*Math.random()).toString(16),ctx.fillRect(0,0,gameCanvas.width,gameCanvas.height),ctx.font=Math.floor(100*Math.random()+20)+"px Arial",ctx.globalAlpha=1,ctx.fillStyle="#"+Math.floor(16777215*Math.random()).toString(16),ctx.textAlign="center",ctx.fillText("WHAT HAVE YOU DONE",gameCanvas.width/2,gameCanvas.height/2),ctx.restore()),shot&&(nutY-=nutSpeedY*(2*Math.random()+.5),nutX+=nutSpeedX*(2*Math.random()+.5)*shootDirection,"hit2"!=nutAnimation?(nutX>1500*Math.random()+100||nutX<500*Math.random())&&(shootDirection*=Math.random()<.5?-1:1,nutSpeedX=(40*Math.random()+10)*(Math.random()<.5?-1:1),nutSpeedY=20*Math.random()+5,"hit1"==nutAnimation&&(nutAnimation="hit2"),"hit0"==nutAnimation&&(nutAnimation="hit1"),hitSfx.pause(),hitSfx.currentTime=0,Math.random()>.5&&hitSfx.play()):wallEnabled&&nutX>1e3*Math.random()+200&&nutX<1e3*Math.random()+300&&(shootDirection*=Math.random()<.5?-1:1,nutSpeedX=(40*Math.random()+10)*(Math.random()<.5?-1:1),nutSpeedY=20*Math.random()+5,Math.random()>.5&&(hitSfx.pause(),hitSfx.currentTime=0,hitSfx.play())),"hit2"==nutAnimation&&(nutX>1600*Math.random()||nutX<200*Math.random())&&(nutY=-999,nutX<200*Math.random()&&(0!=bombPosition||exploded||(exploded=!0,bombAnimation="explode",catAnimation="sad",bombAnimationFrame=0,Math.random()>.5&&boomSfx.play()),1!=bombPosition||won||(won=!0,catAnimation="happy",Math.random()>.5&&meowSfx.play())),nutX>1200*Math.random()+300&&(1!=bombPosition||exploded||(exploded=!0,bombAnimation="explode",catAnimation="sad",bombAnimationFrame=0,Math.random()>.5&&boomSfx.play()),0!=bombPosition||won||(won=!0,catAnimation="happy",Math.random()>.5&&meowSfx.play()))))}function handleClick(a){if(started){const t=gameCanvas.getBoundingClientRect(),n=gameCanvas.width/t.width,e=gameCanvas.height/t.height;a.clientX,t.left,a.clientY,t.top;Math.random()>.5&&(shootDirection=Math.random()<.5?-1:1,shot=!0,leftArrowAnimation=Math.random()>.5?"clicked":"idle",rightArrowAnimation=Math.random()>.5?"clicked":"idle",macamoAnimation=Math.random()>.5?"left":"right",Math.random()>.5&&cannonSfx.play())}}init(),setInterval((function(){animationFrame+=Math.floor(5*Math.random()+1),bombAnimationFrame+=Math.floor(5*Math.random()+1)}),500*Math.random()+100),ctx.imageSmoothingEnabled=!1,gameCanvas.style.imageRendering="pixelated";var started=!1;function startGameOnce(){started||(gameCanvas.addEventListener("click",handleClick),started=!0,Math.random()>.5&&song.play())}gameLoop(),gameCanvas.addEventListener("click",startGameOnce,{once:!0}),song.addEventListener("ended",(function(){location.reload()}));var link=document.createElement("link");function updateFavicon(){link.href=getImagePath("nut",nutAnimation,2)}link.rel="icon",link.type="image/png",document.head.appendChild(link),setInterval(updateFavicon,500*Math.random()+100),document.getElementById("noDithering").addEventListener("change",(function(a){textureSet=a.target.checked?"noDither":"default",document.cookie="textureSet="+textureSet+"; path=/"})),function(){var a=document.cookie.match(/(?:^|; )textureSet=([^;]*)/);a&&(textureSet=a[1],document.getElementById("noDithering").checked="noDither"===textureSet)}();var extrasOpened=!1;document.getElementById("extrasOpenClose").addEventListener("click",(function(){extrasOpened=!extrasOpened,document.getElementById("extras").style.right=extrasOpened?Math.random()>.5?"0":Math.floor(100*Math.random())+"%":Math.random()>.5?"-31%":"-"+Math.floor(100*Math.random())+"%"}));